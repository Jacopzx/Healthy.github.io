<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calorie Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#6366F1',
            secondary: '#8B5CF6',
            accent: '#4F46E5',
            soft: '#EEF2FF',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-soft font-sans min-h-screen flex items-center justify-center">

  <div class="w-full max-w-4xl p-8 bg-white dark:bg-gray-800 rounded-3xl shadow-2xl">
    <header class="text-center mb-10">
      <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-2">ü•ó ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h1>
      <p class="text-md text-gray-500 dark:text-gray-300">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 27 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2568</p>
    </header>

    <!-- ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô -->
    <section class="goal-setting mb-10">
      <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-200 mb-5">üéØ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô</h2>
      <div class="flex gap-4">
        <input type="number" id="goal-input" placeholder="‡πÉ‡∏™‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà)" class="flex-1 px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-primary focus:outline-none">
        <button id="set-goal" class="px-6 py-3 rounded-xl bg-primary hover:bg-secondary text-white font-semibold transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
      <p id="goal-display" class="mt-4 text-gray-600 dark:text-gray-300">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: 0 ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà</p>
    </section>

    <!-- ‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
    <section class="graph mb-10">
      <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-200 mb-5">üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
      <canvas id="calorieChart" class="w-full h-64"></canvas>
    </section>

    <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏û‡∏•‡∏á‡∏á‡∏≤‡∏ô -->
    <section class="stats mb-10">
      <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-200 mb-5">üî• ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
      <div class="flex flex-col items-center">
        <div class="w-36 h-36 rounded-full bg-soft border-8 border-primary flex items-center justify-center text-3xl font-bold text-primary shadow-md mb-5 transition-all" id="circle-display">
          <span id="remaining-calories">1,496</span>
        </div>
        <div class="text-center space-y-1">
          <p class="text-gray-600 dark:text-gray-200">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: <span id="current-goal">0</span> ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà</p>
          <p class="text-gray-600 dark:text-gray-200">‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß: <span id="total-calories">0</span> ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà</p>
        </div>
      </div>
    </section>

    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏°‡∏∑‡πâ‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
    <section class="meal-log space-y-8 mb-10">
      <div>
        <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-200 mb-2">üç≥ ‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤</h3>
        <button class="add-food w-full py-3 bg-accent hover:bg-primary text-white font-semibold rounded-xl transition-all" data-meal="‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
      </div>
      <div>
        <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-200 mb-2">üçö ‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô</h3>
        <button class="add-food w-full py-3 bg-accent hover:bg-primary text-white font-semibold rounded-xl transition-all" data-meal="‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
      </div>
      <div>
        <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-200 mb-2">üç≤ ‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô</h3>
        <button class="add-food w-full py-3 bg-accent hover:bg-primary text-white font-semibold rounded-xl transition-all" data-meal="‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
      </div>
      <div>
        <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-200 mb-2">üç™ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á</h3>
        <button class="add-food w-full py-3 bg-accent hover:bg-primary text-white font-semibold rounded-xl transition-all" data-meal="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
      </div>
    </section>

    <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
    <section class="history-log">
      <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-200 mb-5">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
      <ul id="history-list" class="space-y-3">
        <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
      </ul>
      <button id="clear-history" class="w-full py-3 mt-4 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-xl transition-all">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
    </section>

    <!-- ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô -->
    <button id="toggle-dark" class="absolute top-8 right-8 p-3 rounded-full bg-primary text-white">
      üåô
    </button>

  </div>

  <script>
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å LocalStorage
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }

    let goal = 1496;
    let historyData = [];
    const setGoalButton = document.getElementById('set-goal');
    const goalInput = document.getElementById('goal-input');
    const currentGoalDisplay = document.getElementById('current-goal');
    const remainingCaloriesDisplay = document.getElementById('remaining-calories');
    const historyList = document.getElementById('history-list');
    const clearHistoryButton = document.getElementById('clear-history');
    const ctx = document.getElementById('calorieChart').getContext('2d');
    let calorieChart;

    const chartData = {
      labels: ["‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤", "‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", "‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô", "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á"],
      datasets: [{
        label: "‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà",
        data: [0, 0, 0, 0],
        backgroundColor: ['#6366F1', '#8B5CF6', '#4F46E5', '#A78BFA']
      }]
    };

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    function getTotalCalories() {
      return historyData.reduce((sum, item) => sum + item.calories, 0);
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠
    function updateDisplays() {
      currentGoalDisplay.textContent = goal;
      const totalCalories = getTotalCalories();
      const remainingCalories = goal - totalCalories;
      remainingCaloriesDisplay.textContent = remainingCalories >= 0 ? remainingCalories : 0;

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°
      document.getElementById('remaining-calories').textContent = remainingCalories >= 0 ? remainingCalories : 0;

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°
      const percentage = (totalCalories / goal) * 100;
      const circle = document.getElementById('circle-display');
      circle.style.background = `conic-gradient(#6366F1 ${percentage}%, #EEF2FF ${percentage}% 100%)`;
    }

    // ‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
    function formatDate(date) {
      const d = new Date(date);
      return d.toLocaleString('th-TH', { dateStyle: 'short', timeStyle: 'short' });
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
    function addHistoryItem(meal, calories, time) {
      const li = document.createElement('li');
      li.className = "flex flex-col gap-1 p-4 bg-soft dark:bg-gray-700 rounded-xl shadow-sm transition-all";
      li.innerHTML = ` 
        <div class="flex justify-between items-center">
          <span class="font-medium text-gray-700 dark:text-gray-200">${meal}</span>
          <span class="font-bold text-primary">${calories} ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà</span>
        </div>
        <div class="text-sm text-gray-500 text-right">${formatDate(time)}</div>
      `;
      historyList.prepend(li);
    }

    // ‡πÄ‡∏ã‡∏ü‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á LocalStorage
    function saveHistory() {
      localStorage.setItem('calorieHistory', JSON.stringify(historyData));
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
    function loadHistory() {
      const saved = localStorage.getItem('calorieHistory');
      if (saved) {
        historyData = JSON.parse(saved);
        historyData.forEach(item => {
          addHistoryItem(item.meal, item.calories, item.time);
        });
      }
      updateDisplays();
      updateChart();
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏Å‡∏£‡∏≤‡∏ü
    function updateChart() {
      const meals = ["‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤", "‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", "‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô", "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á"];
      const caloriesByMeal = { "‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤": 0, "‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô": 0, "‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô": 0, "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á": 0 };
      historyData.forEach(item => {
        if (caloriesByMeal[item.meal] !== undefined) caloriesByMeal[item.meal] += item.calories;
      });
      chartData.datasets[0].data = meals.map(meal => caloriesByMeal[meal]);
      if (calorieChart) calorieChart.destroy();
      calorieChart = new Chart(ctx, {
        type: 'bar',
        data: chartData,
        options: {
          scales: { y: { beginAtZero: true }} ,
          plugins: {
            legend: {
              labels: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' }
            }
          }
        }
      });
    }

    // ‡∏Å‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
    setGoalButton.addEventListener('click', () => {
      const newGoal = parseInt(goalInput.value);
      if (!isNaN(newGoal) && newGoal > 0) {
        goal = newGoal;
        goalInput.value = '';
        updateDisplays();
      } else {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      }
    });

    // ‡∏Å‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    function showFoodModal(meal) {
      const modal = document.createElement('div');
      modal.className = "fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50";
      modal.innerHTML = `
        <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-xl max-w-sm w-full space-y-4">
          <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡πÉ‡∏ô ${meal}</h2>
          <input type="number" id="calorie-input" placeholder="‡πÉ‡∏™‡πà‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-primary focus:outline-none">
          <div class="flex justify-end gap-2">
            <button id="cancel-btn" class="px-4 py-2 rounded-xl bg-gray-300 hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="save-btn" class="px-4 py-2 rounded-xl bg-primary hover:bg-secondary text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      document.getElementById('cancel-btn').addEventListener('click', () => {
        document.body.removeChild(modal);
      });

      document.getElementById('save-btn').addEventListener('click', () => {
        const calories = parseInt(document.getElementById('calorie-input').value);
        if (!isNaN(calories) && calories > 0) {
          const time = new Date().toISOString();
          historyData.push({ meal, calories, time });
          addHistoryItem(meal, calories, time);
          updateDisplays();
          updateChart();
          saveHistory();
        }
        document.body.removeChild(modal);
      });
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    const addFoodButtons = document.querySelectorAll('.add-food');
    addFoodButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        const meal = e.target.getAttribute('data-meal');
        showFoodModal(meal);
      });
    });

    // ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
    clearHistoryButton.addEventListener('click', () => {
      historyData = [];
      historyList.innerHTML = '';
      updateDisplays();
      updateChart();
      saveHistory();
    });

    // ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô
    document.getElementById('toggle-dark').addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°
    loadHistory();
  </script>

</body>
</html>
